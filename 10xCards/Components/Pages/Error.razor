@page "/Error"
@using System.Diagnostics
@inject IWebHostEnvironment Environment

<PageTitle>Błąd - 10xCards</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <article role="alert" aria-live="assertive">
                <h1 class="text-danger mb-3">Wystąpił błąd</h1>
                <p class="lead">
                    Wystąpił nieoczekiwany błąd podczas przetwarzania Twojego żądania.
                </p>

                @if (ShowRequestId && IsDevelopment)
                {
                    <div class="alert alert-info" role="status" aria-label="Informacje diagnostyczne">
                        <strong>Identyfikator żądania:</strong> 
                        <code aria-label="ID żądania dla celów diagnostycznych">@RequestId</code>
                        <span class="visually-hidden">
                            Ten identyfikator może być użyty przez zespół wsparcia technicznego do diagnozowania problemu.
                        </span>
                    </div>
                }

                @if (IsDevelopment)
                {
                    <section class="alert alert-warning mt-4" role="region" aria-labelledby="dev-mode-heading">
                        <h2 id="dev-mode-heading" class="h4">Tryb programisty</h2>
                        <p>
                            Przełączenie na środowisko <strong>Development</strong> wyświetli bardziej szczegółowe 
                            informacje o wystąpionym błędzie.
                        </p>
                        <p>
                            <strong>Środowisko Development nie powinno być włączone dla aplikacji produkcyjnych.</strong>
                            Może to skutkować wyświetleniem wrażliwych informacji z wyjątków użytkownikom końcowym.
                            Do lokalnego debugowania włącz środowisko <strong>Development</strong> ustawiając zmienną 
                            środowiskową <strong>ASPNETCORE_ENVIRONMENT</strong> na <strong>Development</strong>
                            i restartując aplikację.
                        </p>
                    </section>
                }
                else
                {
                    <div class="mt-4">
                        <p>
                            Przepraszamy za niedogodności. Nasz zespół został automatycznie poinformowany o problemie 
                            i pracuje nad jego rozwiązaniem.
                        </p>
                        <p>
                            <a href="/" class="btn btn-primary" aria-label="Wróć do strony głównej">
                                Powrót do strony głównej
                            </a>
                        </p>
                    </div>
                }
            </article>
        </div>
    </div>
</div>

@code{
    [CascadingParameter]
    private HttpContext? HttpContext { get; set; }

    private string? RequestId { get; set; }
    private bool ShowRequestId => !string.IsNullOrEmpty(RequestId);
    private bool IsDevelopment => Environment.IsDevelopment();

    protected override void OnInitialized() =>
        RequestId = Activity.Current?.Id ?? HttpContext?.TraceIdentifier;
}

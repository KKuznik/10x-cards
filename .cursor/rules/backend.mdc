---
alwaysApply: false
globs: '**/*.cs, !**/*.razor.cs'
---

## Backend

#### ASP_NET

- Use minimal APIs for simple endpoints in .NET 8+ applications to reduce boilerplate code
- Apply the mediator pattern (MediatR) with CQRS: Commands/Queries + Pipeline Behaviors (validation, logging, performance).
- Validation: FluentValidation + consistent  ProblemDetails (RFC 7807) error responses.
- Error handling: global exception-handling middleware mapping domain exceptions â†’ ProblemDetails; structured logging with `ILogger` and correlation IDs.
- Caching: `ETag`/`If-None-Match` for versioned resources (e.g., `RowVersion` or payload hash). Use `Cache-Control`/`ResponseCache`/`Vary` for cacheable, high-traffic endpoints.
- Use dependency injection with scoped lifetime for request-specific services and singleton for stateless services

#### ENTITY_FRAMEWORK

- Use the repository and unit of work patterns to abstract data access logic and simplify testing
- Tracking: use `AsNoTracking()` for read-only queries; for multi-entity reads consider `AsNoTrackingWithIdentityResolution()`.
- Use migrations for database schema changes and version control with proper naming conventions
- Apply appropriate tracking behavior (AsNoTracking() for read-only queries) to optimize performance
- Implement query optimization techniques like compiled queries for frequently executed database operations
- Complex types: model value objects as owned types; use value converters for custom data types.
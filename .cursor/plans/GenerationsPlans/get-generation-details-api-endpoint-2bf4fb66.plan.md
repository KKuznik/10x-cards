<!-- 2bf4fb66-103e-4147-85eb-46a85a40a339 f71b0d8e-ee6d-45db-a45a-025bbdfa9c8d -->
# API Endpoint Implementation Plan: Get Generation Details

## 1. Przegląd punktu końcowego

Endpoint `GET /api/generations/{id}` pozwala użytkownikowi na pobranie szczegółowych informacji o konkretnej generacji, w tym wszystkich powiązanych fiszek. Wymaga autentykacji JWT i implementuje Row-Level Security (RLS), zapewniając że użytkownik może uzyskać dostęp tylko do własnych generacji.

## 2. Szczegóły żądania

- **Metoda HTTP:** GET
- **Struktura URL:** `/api/generations/{id}`
- **Parametry:**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - **Wymagane:** 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - `id` (long, path parameter) - identyfikator generacji
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - **Opcjonalne:** Brak
- **Request Body:** Nie dotyczy (metoda GET)
- **Authentication:** Bearer token (JWT) w nagłówku Authorization
- **Authorization:** UserId z JWT claims

## 3. Wykorzystywane typy

**Istniejące typy (bez modyfikacji):**

```csharp
// Odpowiedź (10xCards/Models/Responses/GenerationDetailResponse.cs)
public sealed class GenerationDetailResponse {
    public long Id { get; set; }
    public Guid UserId { get; set; }
    public string Model { get; set; }
    public int GeneratedCount { get; set; }
    public int? AcceptedUneditedCount { get; set; }
    public int? AcceptedEditedCount { get; set; }
    public string SourceTextHash { get; set; }
    public int SourceTextLength { get; set; }
    public int GenerationDuration { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
    public List<FlashcardResponse> Flashcards { get; set; }
}

// Fiszka w odpowiedzi (10xCards/Models/Responses/FlashcardResponse.cs)
public sealed class FlashcardResponse {
    public long Id { get; set; }
    public string Front { get; set; }
    public string Back { get; set; }
    public string Source { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
    public long? GenerationId { get; set; }
}
```

**Nowe typy:** Nie są wymagane - endpoint wykorzystuje istniejące modele.

## 4. Szczegóły odpowiedzi

**Success Response (200 OK):**

```json
{
  "id": 5,
  "userId": "550e8400-e29b-41d4-a716-446655440000",
  "model": "openai/gpt-4o-mini",
  "generatedCount": 8,
  "acceptedUneditedCount": 5,
  "acceptedEditedCount": 2,
  "sourceTextHash": "a1b2c3d4e5f6...",
  "sourceTextLength": 2450,
  "generationDuration": 3200,
  "createdAt": "2025-11-03T10:00:00Z",
  "updatedAt": "2025-11-03T10:15:00Z",
  "flashcards": [...]
}
```

**Error Responses:**

- `401 Unauthorized` - Brak/nieprawidłowy token lub nieprawidłowy UserId w claims
- `404 Not Found` - Generacja nie istnieje lub nie należy do użytkownika (RLS)
- `500 Internal Server Error` - Błąd serwera/bazy danych

## 5. Przepływ danych

```
1. Request → Endpoint (GenerationEndpoints.cs)
   ↓
2. Ekstrakcja userId z JWT claims
   ↓
3. Walidacja userId i id parametru
   ↓
4. Service Layer (GenerationService.cs)
   ↓
5. Database Query (EF Core + ApplicationDbContext)
   - Include Flashcards navigation property
   - Filter by UserId (RLS)
   - AsNoTracking() dla performance
   ↓
6. Sprawdzenie czy generacja istnieje i należy do użytkownika
   ↓
7. Mapowanie Entity → DTO (GenerationDetailResponse)
   ↓
8. Response → Client (200 OK lub error)
```

**Database Interactions:**

- Entity: `Generation` z nawigacją do `Flashcards`
- Query: Eager loading z `.Include(g => g.Flashcards)`
- Tracking: `.AsNoTracking()` (read-only)
- Filter: `.Where(g => g.UserId == userId && g.Id == generationId)`

## 6. Względy bezpieczeństwa

1. **Autentykacja:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Endpoint wymaga `.RequireAuthorization()`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - JWT Bearer token w nagłówku Authorization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Walidacja tokenu przez middleware ASP.NET Core Identity

2. **Autoryzacja (Row-Level Security):**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Ekstrakcja UserId z `ClaimTypes.NameIdentifier`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Weryfikacja że `generation.UserId == authenticatedUserId`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Zwrócenie 404 zamiast 403 aby nie ujawniać istnienia zasobu

3. **Walidacja:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - UserId nie może być pustym GUID
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - GenerationId musi być > 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Sprawdzenie czy generacja należy do użytkownika przed zwróceniem danych

4. **Ochrona przed IDOR:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Zawsze sprawdzamy właściciela zasobu
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Nigdy nie zwracamy danych innych użytkowników

## 7. Obsługa błędów

### Error Scenarios i Responses:

| Scenariusz | Status | Response Body | Logging Level |

|------------|--------|---------------|---------------|

| Brak/nieprawidłowy token JWT | 401 | - | Warning |

| Nieprawidłowy UserId w claims | 401 | - | Warning |

| UserId jest pustym GUID | 401 | - | Warning |

| GenerationId ≤ 0 | 404 | `{"message": "Generation not found"}` | Warning |

| Generacja nie istnieje | 404 | `{"message": "Generation not found"}` | Information |

| Generacja należy do innego użytkownika | 404 | `{"message": "Generation not found"}` | Warning (security) |

| Błąd bazy danych | 500 | `{"message": "An error occurred..."}` | Error (z exception) |

### Error Handling Strategy:

1. **Early returns** dla error conditions w service layer
2. **Guard clauses** na początku metody
3. **Try-catch** dla database operations
4. **Structured logging** z kontekstem (userId, generationId)
5. **Generic error messages** dla użytkownika (security)
6. **Detailed logging** dla diagnostyki

## 8. Rozważania dotyczące wydajności

1. **Database Query Optimization:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - `.AsNoTracking()` - brak śledzenia zmian (read-only)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - `.Include(g => g.Flashcards)` - eager loading zamiast N+1 queries
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Indeks na `user_id` w tabeli generations (już istnieje)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Single database round-trip

2. **Response Size:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Potencjalnie duża liczba flashcards (np. max 10-20 per generation)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Brak potrzeby paginacji flashcards (typowo < 20 items)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - JSON serialization optimized przez System.Text.Json

3. **Caching Opportunities:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Rozważyć `ResponseCache` dla często pobieranych generacji
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - `ETag`/`Last-Modified` headers based on `UpdatedAt`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Cache invalidation gdy flashcards są modyfikowane

4. **Potential Bottlenecks:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Brak - prosty query z jednym JOIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Generacja typowo ma < 20 flashcards

## 9. Etapy wdrożenia

### Krok 1: Rozszerzenie interfejsu serwisu

**Plik:** `10xCards/Services/IGenerationService.cs`

Dodać nową metodę do interfejsu:

```csharp
/// <summary>
/// Retrieves detailed information about a specific generation with flashcards
/// </summary>
/// <param name="userId">The ID of the authenticated user</param>
/// <param name="generationId">The ID of the generation to retrieve</param>
/// <param name="cancellationToken">Cancellation token</param>
/// <returns>Result containing generation details with flashcards or error</returns>
Task<Result<GenerationDetailResponse>> GetGenerationDetailsAsync(
    Guid userId,
    long generationId,
    CancellationToken cancellationToken = default);
```

### Krok 2: Implementacja logiki w serwisie

**Plik:** `10xCards/Services/GenerationService.cs`

Zaimplementować metodę z następującą logiką:

```csharp
public async Task<Result<GenerationDetailResponse>> GetGenerationDetailsAsync(
    Guid userId,
    long generationId,
    CancellationToken cancellationToken = default) {
    
    try {
        // Guard clause: validate userId
        if (userId == Guid.Empty) {
            _logger.LogWarning("GetGenerationDetailsAsync called with empty userId");
            return Result<GenerationDetailResponse>.Failure("Invalid user ID");
        }
        
        // Guard clause: validate generationId
        if (generationId <= 0) {
            _logger.LogWarning("GetGenerationDetailsAsync called with invalid generationId: {GenerationId}", generationId);
            return Result<GenerationDetailResponse>.Failure("Generation not found");
        }
        
        // Query generation with flashcards (RLS enforced)
        var generation = await _context.Generations
            .AsNoTracking()
            .Include(g => g.Flashcards)
            .Where(g => g.Id == generationId && g.UserId == userId)
            .FirstOrDefaultAsync(cancellationToken);
        
        // Not found or doesn't belong to user (RLS)
        if (generation == null) {
            _logger.LogWarning(
                "Generation {GenerationId} not found or doesn't belong to user {UserId}",
                generationId, userId);
            return Result<GenerationDetailResponse>.Failure("Generation not found");
        }
        
        // Map to DTO
        var response = new GenerationDetailResponse {
            Id = generation.Id,
            UserId = generation.UserId,
            Model = generation.Model,
            GeneratedCount = generation.GeneratedCount,
            AcceptedUneditedCount = generation.AcceptedUneditedCount,
            AcceptedEditedCount = generation.AcceptedEditedCount,
            SourceTextHash = generation.SourceTextHash,
            SourceTextLength = generation.SourceTextLength,
            GenerationDuration = generation.GenerationDuration,
            CreatedAt = generation.CreatedAt,
            UpdatedAt = generation.UpdatedAt,
            Flashcards = generation.Flashcards
                .Select(f => new FlashcardResponse {
                    Id = f.Id,
                    Front = f.Front,
                    Back = f.Back,
                    Source = f.Source,
                    CreatedAt = f.CreatedAt,
                    UpdatedAt = f.UpdatedAt,
                    GenerationId = f.GenerationId
                })
                .OrderBy(f => f.CreatedAt) // Sorted by creation time
                .ToList()
        };
        
        _logger.LogInformation(
            "Successfully retrieved generation {GenerationId} with {FlashcardCount} flashcards for user {UserId}",
            generationId, response.Flashcards.Count, userId);
        
        return Result<GenerationDetailResponse>.Success(response);
    }
    catch (Exception ex) {
        _logger.LogError(ex,
            "Error retrieving generation {GenerationId} for user {UserId}",
            generationId, userId);
        return Result<GenerationDetailResponse>.Failure(
            "An error occurred while retrieving generation details");
    }
}
```

### Krok 3: Dodanie endpointu w GenerationEndpoints

**Plik:** `10xCards/Endpoints/GenerationEndpoints.cs`

W metodzie `MapGenerationEndpoints`, dodać nowy endpoint po istniejącym GET endpoint:

```csharp
// GET /api/generations/{id}
group.MapGet("{id:long}", async (
    long id,
    IGenerationService generationService,
    ClaimsPrincipal user,
    CancellationToken cancellationToken) => {
    
    // Extract userId from JWT claims
    var userIdClaim = user.FindFirst(ClaimTypes.NameIdentifier)?.Value;
    if (string.IsNullOrEmpty(userIdClaim) || !Guid.TryParse(userIdClaim, out var userId)) {
        return Results.Unauthorized();
    }
    
    var result = await generationService.GetGenerationDetailsAsync(
        userId, id, cancellationToken);
    
    if (!result.IsSuccess) {
        return Results.NotFound(new { message = result.ErrorMessage });
    }
    
    return Results.Ok(result.Value);
})
.WithName("GetGenerationDetails")
.WithSummary("Get detailed information about a specific generation")
.WithDescription("Retrieves generation details with all associated flashcards")
.Produces<GenerationDetailResponse>(StatusCodes.Status200OK)
.Produces(StatusCodes.Status404NotFound)
.Produces(StatusCodes.Status401Unauthorized);
```

### Krok 4: Testowanie

**Plik:** Utworzyć `10xCards/EndpointsTests/GenerationTests/test-get-generation-details-endpoint.http`

```http
### Get Generation Details - Success
GET {{baseUrl}}/api/generations/1
Authorization: Bearer {{authToken}}

### Get Generation Details - Not Found
GET {{baseUrl}}/api/generations/99999
Authorization: Bearer {{authToken}}

### Get Generation Details - Unauthorized (no token)
GET {{baseUrl}}/api/generations/1

### Get Generation Details - Invalid ID
GET {{baseUrl}}/api/generations/0
Authorization: Bearer {{authToken}}

### Get Generation Details - Other User's Generation (should return 404)
GET {{baseUrl}}/api/generations/{{otherUserGenerationId}}
Authorization: Bearer {{authToken}}
```

### Krok 5: Weryfikacja implementacji

1. **Code Review Checklist:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] Guard clauses na początku metody serwisu
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] Walidacja userId i generationId
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] AsNoTracking() użyte dla read-only query
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] Include() użyte dla eager loading flashcards
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] RLS wymuszony (WHERE userId = authenticatedUserId)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] Proper error messages i logging
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] 404 zwracany zamiast 403 dla security
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - [ ] CancellationToken przekazany do async operacji

2. **Testing Scenarios:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Pomyślne pobranie generacji z flashcards
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - 404 dla nieistniejącej generacji
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - 404 dla generacji należącej do innego użytkownika (RLS)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - 401 dla braku tokenu
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - 401 dla nieprawidłowego tokenu

3. **Performance Verification:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Single database query (nie N+1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Query execution time < 50ms (typowo)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Response size proporcjonalny do liczby flashcards

4. **Security Verification:**

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Nie można pobrać generacji innego użytkownika
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - Token JWT wymagany
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - UserId z claims używany (nie z parametrów)

### To-dos

- [ ] Rozszerzyć IGenerationService o metodę GetGenerationDetailsAsync
- [ ] Zaimplementować GetGenerationDetailsAsync w GenerationService z RLS i eager loading
- [ ] Dodać endpoint GET /api/generations/{id} w GenerationEndpoints
- [ ] Utworzyć plik testowy test-get-generation-details-endpoint.http
- [ ] Przeprowadzić testy i weryfikację security/performance